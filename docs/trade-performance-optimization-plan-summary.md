# äº¤æ˜“æ€§èƒ½ä¼˜åŒ–è®¡åˆ’ - æ›´æ–°æ‘˜è¦

## ğŸ“ å…³é”®è°ƒæ•´

åŸºäºç”¨æˆ·åé¦ˆï¼Œå¯¹åŸè®¡åˆ’è¿›è¡Œäº†ä»¥ä¸‹é‡è¦è°ƒæ•´ï¼š

### 1. ç¼“å­˜ç­–ç•¥è°ƒæ•´

**åŸè®¡åˆ’**ï¼š
- å·²è¿ç§»ä»£å¸ï¼šæ°¸ä¹…ç¼“å­˜
- æœªè¿ç§»ä»£å¸ï¼š1 å°æ—¶ TTL

**è°ƒæ•´å**ï¼š
- âœ… **æœªè¿ç§»å’Œå·²è¿ç§»ä»£å¸éƒ½ä½¿ç”¨æ°¸ä¹…ç¼“å­˜**
- âœ… **åªåœ¨è¿ç§»çŠ¶æ€å˜åŒ–æ—¶æ›´æ–°**
- âœ… **ç»Ÿä¸€çš„ç¼“å­˜é€»è¾‘ï¼Œä»£ç å¤ç”¨**

### 2. å¤šä»£å¸æ”¯æŒ

**æ–°å¢è¦æ±‚**ï¼š
- âœ… æ‰€æœ‰ç¼“å­˜ä½¿ç”¨ `tokenAddress` ä½œä¸ºé”®
- âœ… æ”¯æŒå¤šä»£å¸å¹¶å­˜ï¼Œä¸äº’ç›¸è¦†ç›–
- âœ… åˆ‡æ¢ä»£å¸æ—¶ç›´æ¥ä½¿ç”¨ç¼“å­˜

**ç¼“å­˜é”®è®¾è®¡**ï¼š
```typescript
// è·¯ç”±ç¼“å­˜ï¼štokenAddress
routeCache.get(tokenAddress.toLowerCase())

// ä½™é¢ç¼“å­˜ï¼štokenAddress
balanceCache.get(tokenAddress.toLowerCase())

// Quote token ä½™é¢ï¼šquoteToken-wallet
quoteCache.get(`${quoteToken}-${wallet}`)

// æˆæƒçŠ¶æ€ï¼štoken-spender
approvalCache.get(`${token}-${spender}`)
```

### 3. å¤šæ ‡ç­¾é¡µæ”¯æŒ

**æ–°å¢è¦æ±‚**ï¼š
- âœ… åŒæ—¶æ‰“å¼€å¤šä¸ªä»£å¸é¡µé¢æ—¶ï¼Œæ¯ä¸ªä»£å¸ç‹¬ç«‹ç¼“å­˜
- âœ… åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œæ— éœ€é‡æ–°æŸ¥è¯¢
- âœ… é¿å…æ ‡ç­¾é¡µåˆ‡æ¢å¯¼è‡´æ•°æ®é‡æ–°åŠ è½½

**åœºæ™¯ç¤ºä¾‹**ï¼š
```
Tab 1: ä»£å¸ A â†’ ç¼“å­˜ A çš„æ‰€æœ‰ä¿¡æ¯
Tab 2: ä»£å¸ B â†’ ç¼“å­˜ B çš„æ‰€æœ‰ä¿¡æ¯
Tab 3: ä»£å¸ C â†’ ç¼“å­˜ C çš„æ‰€æœ‰ä¿¡æ¯

åˆ‡æ¢ Tab 1 â†” Tab 2 â†” Tab 3ï¼š
  - ç›´æ¥ä½¿ç”¨å„è‡ªçš„ç¼“å­˜
  - æ— éœ€é‡æ–°æŸ¥è¯¢
```

### 4. ä»£ç å¤ç”¨

**æ–°å¢è¦æ±‚**ï¼š
- âœ… æœªè¿ç§»å’Œå·²è¿ç§»ä»£å¸ä½¿ç”¨ç›¸åŒçš„å¤„ç†é€»è¾‘
- âœ… ç»Ÿä¸€çš„æŸ¥è¯¢æ¥å£
- âœ… å‡å°‘é‡å¤ä»£ç 

**è®¾è®¡ç¤ºä¾‹**ï¼š
```typescript
// ç»Ÿä¸€æ¥å£
async function prepareTokenBuy(params) {
  if (route.readyForPancake) {
    return preparePancakeBuy(params);  // å·²è¿ç§»
  } else {
    return preparePlatformBuy(params); // æœªè¿ç§»
  }
}

// ä¸¤ç§å®ç°éƒ½ä½¿ç”¨ç›¸åŒçš„å¹¶å‘æ¨¡å¼
async function preparePlatformBuy(params) {
  const [balance, allowance, price] = await Promise.all([...]);
}

async function preparePancakeBuy(params) {
  const [balance, allowance, price] = await Promise.all([...]);
}
```

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡ï¼ˆæ›´æ–°åï¼‰

### æ€§èƒ½ç›®æ ‡

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| é¦–æ¬¡äº¤æ˜“ï¼ˆå·²æˆæƒï¼‰ | 1600-3300ms | **< 1000ms** | **60-70%** |
| ç¬¬äºŒæ¬¡äº¤æ˜“ | 800-1600ms | **< 1000ms** | **0-50%** |
| åˆ‡æ¢ä»£å¸ | éœ€è¦é‡æ–°æŸ¥è¯¢ | **ç›´æ¥ä½¿ç”¨ç¼“å­˜** | **100%** |
| åˆ‡æ¢æ ‡ç­¾é¡µ | éœ€è¦é‡æ–°æŸ¥è¯¢ | **ç›´æ¥ä½¿ç”¨ç¼“å­˜** | **100%** |

### ç¼“å­˜æ•ˆæœ

| æ•°æ®ç±»å‹ | åŸè®¡åˆ’ | è°ƒæ•´å | æ•ˆæœ |
|---------|--------|--------|------|
| è·¯ç”±ä¿¡æ¯ï¼ˆå·²è¿ç§»ï¼‰ | æ°¸ä¹…ç¼“å­˜ | æ°¸ä¹…ç¼“å­˜ | âœ… ä¿æŒ |
| è·¯ç”±ä¿¡æ¯ï¼ˆæœªè¿ç§»ï¼‰ | 1 å°æ—¶ TTL | **æ°¸ä¹…ç¼“å­˜** | âœ… æå‡ |
| å¤šä»£å¸æ”¯æŒ | æœªæ˜ç¡® | **å®Œå…¨æ”¯æŒ** | âœ… æ–°å¢ |
| å¤šæ ‡ç­¾é¡µæ”¯æŒ | æœªæ˜ç¡® | **å®Œå…¨æ”¯æŒ** | âœ… æ–°å¢ |

---

## ğŸ“… å¼€å‘æ—¶é—´è¡¨ï¼ˆä¸å˜ï¼‰

- **ç¬¬ 1 å‘¨**ï¼šæ ¸å¿ƒä¼˜åŒ–ï¼ˆè·¯ç”±ç¼“å­˜ã€é¢„åŠ è½½ã€ä½™é¢ç­–ç•¥ï¼‰
- **ç¬¬ 2 å‘¨**ï¼šå¹¶å‘ä¼˜åŒ–ã€è°ƒæŸ¥å’Œè¡¥å……ä¼˜åŒ–

---

## âœ… éªŒæ”¶æ ‡å‡†ï¼ˆæ›´æ–°ï¼‰

### åŠŸèƒ½å®Œæ•´æ€§

- [ ] æœªè¿ç§»å’Œå·²è¿ç§»ä»£å¸éƒ½ä½¿ç”¨æ°¸ä¹…ç¼“å­˜
- [ ] æ‰€æœ‰ç¼“å­˜ä½¿ç”¨ tokenAddress ä½œä¸ºé”®
- [ ] æ”¯æŒå¤šä»£å¸å¹¶å­˜ï¼ˆè‡³å°‘ 50 ä¸ªä»£å¸ï¼‰
- [ ] æ”¯æŒå¤šæ ‡ç­¾é¡µåŒæ—¶æ‰“å¼€ä¸åŒä»£å¸
- [ ] åˆ‡æ¢ä»£å¸/æ ‡ç­¾é¡µæ—¶ç›´æ¥ä½¿ç”¨ç¼“å­˜
- [ ] æœªè¿ç§»å’Œå·²è¿ç§»ä»£å¸ä½¿ç”¨ç»Ÿä¸€çš„å¤„ç†é€»è¾‘
- [ ] é¦–æ¬¡äº¤æ˜“ï¼ˆå·²æˆæƒï¼‰< 1000ms
- [ ] ç¬¬äºŒæ¬¡äº¤æ˜“ < 1000ms

### ä»£ç è´¨é‡

- [ ] ç¼“å­˜é”®è®¾è®¡ç»Ÿä¸€è§„èŒƒ
- [ ] ä»£ç å¤ç”¨ç‡é«˜ï¼ˆæœªè¿ç§»å’Œå·²è¿ç§»å…±äº«é€»è¾‘ï¼‰
- [ ] ç¼“å­˜æ¸…ç†ç­–ç•¥å®Œå–„ï¼ˆé¿å…å†…å­˜æ³„æ¼ï¼‰
- [ ] å¤šä»£å¸/å¤šæ ‡ç­¾é¡µåœºæ™¯æµ‹è¯•é€šè¿‡

---

## ğŸ“Š å…³é”®æ”¹è¿›ï¿½ï¿½æ€»ç»“

1. **ç¼“å­˜ç­–ç•¥ç»Ÿä¸€**ï¼šæœªè¿ç§»å’Œå·²è¿ç§»éƒ½ç”¨æ°¸ä¹…ç¼“å­˜ï¼Œç®€åŒ–é€»è¾‘
2. **å¤šä»£å¸æ¶æ„**ï¼šæ”¯æŒåŒæ—¶ç¼“å­˜å¤šä¸ªä»£å¸ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
3. **å¤šæ ‡ç­¾é¡µä¼˜åŒ–**ï¼šåˆ‡æ¢æ ‡ç­¾é¡µæ— éœ€é‡æ–°æŸ¥è¯¢ï¼Œæ€§èƒ½æå‡ 100%
4. **ä»£ç å¤ç”¨**ï¼šå‡å°‘é‡å¤ä»£ç ï¼Œæå‡å¯ç»´æŠ¤æ€§

---

**æ›´æ–°æ—¶é—´**ï¼š2026-01-26
**ç‰ˆæœ¬**ï¼šv2.0ï¼ˆåŸºäºç”¨æˆ·åé¦ˆè°ƒæ•´ï¼‰
