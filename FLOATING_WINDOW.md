# 浮动交易窗口使用说明

## 功能特性

浮动交易窗口是一个极简、高效的交易界面，专为快速交易设计。

### 主要特点

1. **极简设计**
   - 紧凑的窗口尺寸（220px 宽度）
   - 只显示必要的交易按钮和设置
   - 不显示钱包状态等冗余信息

2. **高效操作**
   - 一键买入/卖出（使用预设固定值）
   - 点击按钮直接触发交易，无需额外确认
   - 可拖拽到屏幕任意位置

3. **智能状态管理**
   - 窗口位置自动记忆
   - 设置折叠状态自动保存
   - 刷新页面后保持原有位置和状态

4. **可折叠设置区**
   - 滑点和 Gas 设置默认收起
   - 点击"设置"按钮展开/收起
   - 减少屏幕占用空间

## 使用方法

### 创建浮动窗口

在 content script 或其他页面脚本中调用：

```javascript
// 自动检测当前页面的代币地址
createFloatingTradingWindow();

// 或指定代币地址
createFloatingTradingWindow('0x1234...');
```

### 窗口结构

```
┌─────────────────────┐
│ ⋮⋮              ✕  │ ← 顶栏（拖拽手柄 + 关闭按钮）
├─────────────────────┤
│ 买入 (BNB)          │
│ [0.02] [0.05] ...   │ ← 买入按钮（固定值）
│                     │
│ 卖出 (%)            │
│ [25%] [50%] ...     │ ← 卖出按钮（固定值）
│                     │
│ ▼ 设置              │ ← 折叠/展开按钮
├─────────────────────┤
│ 滑点 (%)：          │
│ [10%] [50%] [输入]  │ ← 设置区（可折叠）
│                     │
│ Buy Gas：           │
│ [0.05] [1] [输入]   │
│                     │
│ Sell Gas：          │
│ [0.05] [1] [输入]   │
└─────────────────────┘
```

### 交易流程

1. **买入交易**
   - 点击任意买入按钮（如"0.05"）
   - 按钮显示"..."表示交易进行中
   - 交易完成后按钮恢复原状

2. **卖出交易**
   - 点击任意卖出按钮（如"50%"）
   - 按钮显示"..."表示交易进行中
   - 交易完成后按钮恢复原状

3. **调整设置**
   - 点击"设置"按钮展开设置区
   - 点击预设按钮或手动输入数值
   - 设置即时生效，下次交易使用新设置

### 窗口操作

1. **拖拽移动**
   - 鼠标移到顶栏"⋮⋮"区域
   - 按住鼠标左键拖动
   - 松开鼠标完成移动（位置自动保存）

2. **关闭窗口**
   - 点击右上角"✕"按钮

3. **折叠/展开设置**
   - 点击"设置"按钮切换展开/收起状态
   - 状态自动保存

## 技术实现

### 状态持久化

窗口使用 `localStorage` 保存以下状态：

```typescript
{
  position: { x: number; y: number },  // 窗口位置
  collapsed: boolean                    // 设置区折叠状态
}
```

存储键名：`dogBangFloatingWindow`

### 样式类名

- `.dog-bang-floating-window` - 窗口容器
- `.floating-header` - 顶栏
- `.floating-drag-handle` - 拖拽手柄
- `.floating-close-btn` - 关闭按钮
- `.floating-trade-section` - 交易区
- `.floating-quick-btn` - 买入/卖出按钮
- `.floating-settings-section` - 设置区
- `.floating-toggle-btn` - 折叠/展开按钮

### 交易接口

浮动窗口复用现有的交易逻辑，通过 `sendPortRequest` 与 background 通信：

```javascript
// 买入
await sendPortRequest({
  action: 'trade-buy',
  tokenAddress,
  amount,
  slippage,
  gasPrice
});

// 卖出
await sendPortRequest({
  action: 'trade-sell',
  tokenAddress,
  percent,
  slippage,
  gasPrice
});
```

## 设计理念

浮动窗口专注于以下设计目标：

1. **极简** - 移除所有非必要元素，只保留交易核心功能
2. **高效** - 一键交易，减少操作步骤
3. **灵活** - 可拖拽，可收起设置，适应不同使用场景
4. **智能** - 记忆位置和状态，提供一致的使用体验

## 与 Side Panel 的区别

| 特性 | 浮动窗口 | Side Panel |
|------|---------|-----------|
| 位置 | 可拖拽到任意位置 | 固定在浏览器侧边栏 |
| 大小 | 紧凑（220px） | 较大（360px） |
| 信息显示 | 只显示交易按钮 | 显示完整信息（余额、状态等） |
| 交易方式 | 一键触发 | 需要点击买入/卖出按钮 |
| 设置区 | 可折叠 | 始终展开 |
| 适用场景 | 快速交易 | 详细交易管理 |

## 样式自定义

可以通过修改 `extension/styles.css` 中的以下变量来自定义样式：

```css
/* 窗口尺寸 */
.dog-bang-floating-window {
  width: 220px;  /* 调整窗口宽度 */
}

/* 按钮颜色 */
.floating-quick-btn {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
}

/* 买入按钮颜色 */
.floating-quick-btn[data-action="buy"] { ... }

/* 卖出按钮颜色 */
.floating-quick-btn[data-action="sell"] { ... }
```

## 浏览器兼容性

- Chrome/Edge 88+
- Firefox 78+
- Safari 14+

## 注意事项

1. 浮动窗口使用 `z-index: 999999` 确保始终在最上层
2. 窗口拖拽有边界限制，防止拖出屏幕
3. 交易按钮在交易进行中会自动禁用，防止重复点击
4. 设置区折叠状态会在每次切换后立即保存
